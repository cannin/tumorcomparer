---
title: "Tumor Comparer"
output:
  html_notebook: default
  html_document:
    toc: yes
  pdf_document:
    toc: yes
---

```{r setup, echo=FALSE, warning=FALSE, message=FALSE}
require("knitr")
opts_knit$set(root.dir="..")
opts_chunk$set(fig.align="center", fig.width=6, fig.height=6, dpi=300)

```

## Overview

Comparison of cell lines (the most popular experimental models of cancer) and tumors is challenging because of systematic differences between cell lines and tumors due to several factors, including biases in the selection of tumors for establishing cell lines, the process of immortalization of cell lines, and further changes gradually acquired by cell lines over time (e.g. due to passaging in culture).

This package includes a general computational method, TumorComparer, to systematically quantify similarities and differences between tumor material when detailed genetic and molecular profiles are available. Importantly, the comparisons can be flexibly tailored to a particular biological question by (interactively) placing a higher weight on functional alterations of interest (weighted similarity). This application allows this comparison to be run on cell lines in the comparison of six different cancer types to identify suitable as well as apparently unsuitable cell lines (including some widely used ones) for each cancer type. 

## Getting started 
```{r loadLibraries, message=FALSE, warning=FALSE}
library(tumorcomparer)
```

A list of all accessible vignettes and methods is available with the following command.

```{r}
help.search("tumorcomparer")
```

## Load Data
```{r}
# Load pre-computed weights from R package
pancancer_gene_weights_file <- system.file("extdata", "weights", "default_weights_for_known_cancer_genes.txt", package="tumorcomparer")
cancer_specific_gene_weights_file <- system.file("extdata", "weights", "Genes_and_weights_TCGA_LUSC_based.txt", package="tumorcomparer")

tumor_mut_file <- system.file("extdata", "tumor_alterations", "TCGA_LUSC_MUT.txt", package="tumorcomparer")
tumor_cna_file <- system.file("extdata", "tumor_alterations", "TCGA_LUSC_CNA.txt", package="tumorcomparer")

cell_line_mut_file <- system.file("extdata", "cell_line_alterations", "CCLE_LUSC_MUT.txt", package="tumorcomparer")
cell_line_cna_file <- system.file("extdata", "cell_line_alterations", "CCLE_LUSC_CNA.txt", package="tumorcomparer")

# Do not save the output
output_composite_alteration_matrix_file <- NULL

# Use weighted correlation
distance_similarity_measure <- "weighted_correlation"

# Run comparison 
comparison <- run_comparison(pancancer_gene_weights_file=pancancer_gene_weights_file, 
               cancer_specific_gene_weights_file=cancer_specific_gene_weights_file, 
               tumor_mut_file=tumor_mut_file, 
               tumor_cna_file=tumor_cna_file,
               cell_line_mut_file=cell_line_mut_file,
               cell_line_cna_file=cell_line_cna_file, 
               output_composite_alteration_matrix_file=output_composite_alteration_matrix_file,
               distance_similarity_measure=distance_similarity_measure)

# See returned outputs
names(comparison)
```

## Categorize Results
```{r}
categorization <- categorize_cell_lines(fraction_of_tumors_for_comparison=0.1, 
                      dist_mat=comparison$dist_mat,
                      composite_mat=comparison$composite_mat,
                      cell_lines_with_both_MUT_and_CNA=comparison$cell_lines_with_both_MUT_and_CNA, 
                      tumors_with_both_MUT_and_CNA=comparison$tumors_with_both_MUT_and_CNA,
                      trim_cell_line_names=TRUE)
# See returned outputs
names(categorization)
```

## Plot MDS Results
```{r}
plot_mds(comparison_list=comparison, categorization_list=categorization, trim_cell_line_names = TRUE)
```

## Plot Alteration Frequency Plot Results
```{r}
# Get shortened cell line names
results <- plot_freq_alt(comparison_list=comparison, trim_cell_line_names=TRUE)
```









